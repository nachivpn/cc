module CC.CC (Ty : Set) (Var : Ty â†’ Ty â†’ Set) where

-- Reference: I Beylin and P Dybjer (1995)

open import Relation.Binary.Construct.Closure.Equivalence
  using (EqClosure ; symmetric)
  renaming (isEquivalence to EqClosureIsEquivalence)

private
  variable
    a b c : Ty

infixr 4 _âˆ™_

data Tm : (a b : Ty) â†’ Set where
  var   : Var a b â†’ Tm a b
  id    : Tm a a
  _âˆ™_   : Tm b c â†’ Tm a b â†’ Tm a c

infix 3 _â‰ˆ_ _âˆ¼_

private
  variable
    f g h : Tm a b

data _âˆ¼_ : Tm a b â†’ Tm a b â†’ Set where
  idl-âˆ¼   : id âˆ™ f âˆ¼ f
  idr-âˆ¼   : f âˆ¼ f âˆ™ id
  assoc-âˆ¼ : (f âˆ™ g) âˆ™ h âˆ¼ f âˆ™ (g âˆ™ h)

_â‰ˆ_  : Tm a b â†’ Tm a b â†’ Set
_â‰ˆ_   = EqClosure _âˆ¼_

-- Obs: Tm/â‰ˆ gives the free category generated by a graph whose nodes
-- are given by `Ty` and edges are given by `Var`

data ğ’© : (a b : Ty) â†’ Set where
  id    : ğ’© a a
  _âˆ™_   : Var b c â†’ ğ’© a b â†’ ğ’© a c

Tm' : Ty â†’ Ty â†’ Set
Tm' a b  = ğ’© a b

âŸ¦_âŸ§â†’Ì‡âŸ¦_âŸ§ : Ty â†’ Ty â†’ Set
âŸ¦ a âŸ§â†’Ì‡âŸ¦ b âŸ§ = {c : Ty} â†’ (Tm' c a â†’ Tm' c b)

eval : Tm a b â†’ âŸ¦ a âŸ§â†’Ì‡âŸ¦ b âŸ§
eval (var x)    = x âˆ™_
eval id         = Î» z â†’ z
eval (t âˆ™ u)    = Î» x â†’ eval t (eval u x)

rf : ğ’© a b â†’ Tm a b
rf id      = id
rf (x âˆ™ t) = var x âˆ™ rf t

quot : âŸ¦ a âŸ§â†’Ì‡âŸ¦ b âŸ§ â†’ Tm a b
quot f = rf (f id)

norm : Tm a b â†’ Tm a b
norm t = quot (eval t)
